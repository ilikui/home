<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>书籍/电影/音乐展示</title>
<style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f0f0; }
    .tabs { display: flex; justify-content: center; margin: 20px 0; }
    .tab { margin: 0 10px; padding: 10px 20px; background: #fff; cursor: pointer; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);}
    .tab.active { background: #007bff; color: #fff; }
    .container { max-width: 900px; margin: 0 auto; background: #fff; border-radius: 8px; padding: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    .item { display: flex; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
    .item img { width: 120px; height: auto; margin-right: 20px; border-radius: 8px; }
    .info h3 { margin: 0 0 10px 0; }
    .info p { margin: 3px 0; }
    .pagination { text-align: center; margin-top: 20px; }
    .pagination button { margin: 0 5px; padding: 5px 10px; border: none; background: #007bff; color: #fff; cursor: pointer; border-radius: 3px; }
    .pagination button.disabled { background: #aaa; cursor: not-allowed; }
</style>
</head>
<body>

<div class="tabs">
    <div class="tab active" data-type="books">书籍</div>
    <div class="tab" data-type="movies">电影</div>
    <div class="tab" data-type="music">音乐</div>
</div>

<div class="container" id="content"></div>
<div class="pagination" id="pagination"></div>

<script>
const pageSize = 5;
let currentPage = 1;
let currentData = [];
let currentType = 'books';

const jsonFiles = {
    books: './static/data/book.json',
    movies: './static/data/movie.json',
    music: './static/data/music.json'
};

function loadJSON(type, page = 1) {
    currentType = type;
    currentPage = page;

    fetch(jsonFiles[type] + '?_=' + new Date().getTime())
        .then(res => res.json())
        .then(data => {
            currentData = data;
            renderPage();
        })
        .catch(err => {
            document.getElementById('content').innerHTML = '数据加载失败: ' + err;
        });
}

function renderPage() {
    const container = document.getElementById('content');
    container.innerHTML = '';
    const start = (currentPage - 1) * pageSize;
    const end = start + pageSize;
    const pageData = currentData.slice(start, end);

    pageData.forEach(item => {
        const div = document.createElement('div');
        div.className = 'item';

        const img = document.createElement('img');
        img.src = item.subject.cover_url || '';
        div.appendChild(img);

        const info = document.createElement('div');
        info.className = 'info';

        const title = document.createElement('h3');
        title.textContent = item.subject.title || '未知';
        info.appendChild(title);

        if(currentType === 'books'){
            const author = document.createElement('p');
            author.textContent = '作者: ' + (item.subject.author?.map(a=>a.name).join(', ') || '未知');
            info.appendChild(author);

            const pubdate = document.createElement('p');
            pubdate.textContent = '出版日期: ' + (item.subject.pubdate?.[0] || '未知');
            info.appendChild(pubdate);

        } else if(currentType === 'movies'){
            const director = document.createElement('p');
            director.textContent = '导演: ' + (item.subject.directors?.map(d=>d.name).join(', ') || '未知');
            info.appendChild(director);

            const actors = document.createElement('p');
            actors.textContent = '主演: ' + (item.subject.actors?.map(a=>a.name).join(', ') || '未知');
            info.appendChild(actors);

            const pubdate = document.createElement('p');
            pubdate.textContent = '上映日期: ' + (item.subject.pubdate?.[0] || '未知');
            info.appendChild(pubdate);

            const rating = document.createElement('p');
            const ratingText = item.sharing_text?.match(/★+/);
            rating.textContent = '评分: ' + (ratingText ? ratingText[0] : '暂无评分');
            info.appendChild(rating);

        } else if(currentType === 'music'){
            const singer = document.createElement('p');
            singer.textContent = '歌手: ' + (item.subject.singer?.map(s=>s.name).join(', ') || '未知');
            info.appendChild(singer);

            const pubdate = document.createElement('p');
            pubdate.textContent = '发行日期: ' + (item.subject.pubdate?.[0] || '未知');
            info.appendChild(pubdate);

            const rating = document.createElement('p');
            const ratingText = item.sharing_text?.match(/★+/);
            rating.textContent = '评分: ' + (ratingText ? ratingText[0] : '暂无评分');
            info.appendChild(rating);
        }

        const link = document.createElement('a');
        link.href = item.subject.url || '#';
        link.textContent = '了解更多';
        link.target = '_blank';
        info.appendChild(link);

        div.appendChild(info);
        container.appendChild(div);
    });

    renderPagination();
}

function renderPagination(){
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    const totalPages = Math.ceil(currentData.length / pageSize);

    const prevBtn = document.createElement('button');
    prevBtn.textContent = '上一页';
    prevBtn.disabled = currentPage === 1;
    prevBtn.className = currentPage === 1 ? 'disabled' : '';
    prevBtn.onclick = ()=>{ if(currentPage>1) loadJSON(currentType,currentPage-1); };
    pagination.appendChild(prevBtn);

    const nextBtn = document.createElement('button');
    nextBtn.textContent = '下一页';
    nextBtn.disabled = currentPage === totalPages;
    nextBtn.className = currentPage === totalPages ? 'disabled' : '';
    nextBtn.onclick = ()=>{ if(currentPage<totalPages) loadJSON(currentType,currentPage+1); };
    pagination.appendChild(nextBtn);

    const pageInfo = document.createElement('span');
    pageInfo.style.marginLeft='10px';
    pageInfo.textContent = `第 ${currentPage} / ${totalPages} 页`;
    pagination.appendChild(pageInfo);
}

document.querySelectorAll('.tab').forEach(tab=>{
    tab.onclick = ()=>{
        document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        tab.classList.add('active');
        loadJSON(tab.dataset.type,1);
    }
});

window.onload = ()=>{ loadJSON('books',1); }
</script>

</body>
</html>
