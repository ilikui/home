<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>多媒体信息</title>
<style>
body { font-family: Arial, sans-serif; margin: 0; padding: 0; background-color: #f8f8f8; }
.container { max-width: 800px; margin: 20px auto; padding: 20px; background-color: #fff; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
.item { border-bottom:1px solid #eee; padding:20px 0; display:flex; align-items:center; }
.item img { width:100px; height:auto; margin-right:20px; border-radius:8px; box-shadow:0 0 5px rgba(0,0,0,0.1);}
.item-info { flex:1;}
.item-info h2 { margin-top:0;margin-bottom:10px;font-size:24px;}
.item-info p { margin:5px 0; }
.rating { font-size:20px;color:#FFD700; }
.tags { color:#666; }
.item-info a { color:#007bff; text-decoration:none; }
.tab { display:flex; justify-content:center; margin-bottom:20px;}
.tab button { padding:10px 20px; margin:0 5px; border:none; border-radius:5px; cursor:pointer; background:#eee;}
.tab button.active { background:#007bff;color:#fff; }
.pagination { text-align:center; margin-top:20px; }
.pagination button { padding:5px 10px; margin:0 2px; border:none; border-radius:3px; cursor:pointer; background:#eee; }
.pagination button.active { background:#007bff;color:#fff; }
</style>
</head>
<body>

<div class="tab">
    <button data-type="book" class="active">书籍</button>
    <button data-type="movie">电影</button>
    <button data-type="music">音乐</button>
</div>

<div class="container" id="contentContainer"></div>

<div class="pagination" id="paginationContainer"></div>

<script>
const PAGE_SIZE = 5;
let currentData = [];
let currentPage = 1;
let currentType = 'book';

// GitHub Pages 兼容路径，假设 HTML 在根目录，数据在 ./static/data/
const dataPaths = {
    book: './static/data/book.json',
    movie: './static/data/movie.json',
    music: './static/data/music.json'
};

// 加载 JSON 数据
async function loadData(type){
    currentType = type;
    currentPage = 1;
    try{
        const res = await fetch(dataPaths[type]);
        if(!res.ok) throw new Error('网络错误或文件未找到');
        const data = await res.json();
        currentData = data;
        renderPage();
    } catch(e){
        document.getElementById('contentContainer').innerHTML = `<p style="color:red;">加载失败: ${e.message}</p>`;
    }
}

// 渲染当前页数据
function renderPage(){
    const start = (currentPage-1)*PAGE_SIZE;
    const pageData = currentData.slice(start, start+PAGE_SIZE);
    const container = document.getElementById('contentContainer');
    container.innerHTML = '';

    pageData.forEach(item=>{
        const div = document.createElement('div');
        div.className = 'item';

        const img = document.createElement('img');
        img.src = item.subject?.cover_url || item.cover_url || '';
        img.alt = item.subject?.title || item.title || '';
        div.appendChild(img);

        const info = document.createElement('div');
        info.className = 'item-info';

        const title = document.createElement('h2');
        title.textContent = item.subject?.title || item.title || '';
        info.appendChild(title);

        if(item.sharing_text){
            const ratingText = item.sharing_text.match(/★+/);
            const rating = document.createElement('p');
            rating.className = 'rating';
            rating.textContent = ratingText ? "评分: "+ratingText[0] : "暂无评分";
            info.appendChild(rating);
        }

        if(item.tags){
            const tags = document.createElement('p');
            tags.className = 'tags';
            tags.textContent = "标签: " + item.tags.join(', ');
            info.appendChild(tags);
        }

        if(item.subject?.directors){
            const director = document.createElement('p');
            director.textContent = "导演: " + item.subject.directors.map(d=>d.name).join(', ');
            info.appendChild(director);
        }

        if(item.subject?.actors){
            const actors = document.createElement('p');
            actors.textContent = "主演: " + item.subject.actors.map(a=>a.name).join(', ');
            info.appendChild(actors);
        }

        if(item.subject?.pubdate){
            const pubdate = document.createElement('p');
            pubdate.textContent = "上映日期: " + item.subject.pubdate[0];
            info.appendChild(pubdate);
        }

        const link = document.createElement('a');
        link.href = item.subject?.url || item.url || '#';
        link.textContent = "了解更多";
        info.appendChild(link);

        div.appendChild(info);
        container.appendChild(div);
    });

    renderPagination();
}

// 渲染分页
function renderPagination(){
    const container = document.getElementById('paginationContainer');
    const pageCount = Math.ceil(currentData.length / PAGE_SIZE);
    container.innerHTML = '';
    for(let i=1;i<=pageCount;i++){
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = (i===currentPage)?'active':'';
        btn.onclick = ()=>{currentPage=i; renderPage();};
        container.appendChild(btn);
    }
}

// tab 切换
document.querySelectorAll('.tab button').forEach(btn=>{
    btn.addEventListener('click',()=>{
        document.querySelectorAll('.tab button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        loadData(btn.dataset.type);
    });
});

// 初始加载书籍
loadData(currentType);
</script>

</body>
</html>
