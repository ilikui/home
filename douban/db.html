<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>我的收藏</title>
<style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f0f0; }
    .container { max-width: 900px; margin:20px auto; padding:20px; background:#fff; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
    .tabs { display:flex; margin-bottom:20px; cursor:pointer; }
    .tab { padding:10px 20px; border:1px solid #ccc; border-bottom:none; border-radius:8px 8px 0 0; background:#eee; margin-right:5px;}
    .tab.active { background:#fff; font-weight:bold; }
    .items { display:none; flex-direction:column; }
    .items.active { display:flex; }
    .item { display:flex; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;}
    .item img { width:100px; height:auto; margin-right:20px; border-radius:5px; }
    .info h3 { margin:0 0 5px 0; }
    .info p { margin:3px 0; color:#555; }
    .pagination { margin-top:20px; text-align:center; }
    .pagination button { margin:0 5px; padding:5px 10px; }
</style>
</head>
<body>

<div class="container">
    <div class="tabs">
        <div class="tab active" data-type="books">书籍</div>
        <div class="tab" data-type="movies">电影</div>
        <div class="tab" data-type="music">音乐</div>
    </div>
    <div id="books" class="items active"></div>
    <div id="movies" class="items"></div>
    <div id="music" class="items"></div>
    <div class="pagination" id="pagination"></div>
</div>

<script>
const pageSize = 5; // 每页显示条数
let currentPage = { books:1, movies:1, music:1 };
let dataStore = { books:[], movies:[], music:[] };

// 切换标签
document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const type = tab.dataset.type;
        document.querySelectorAll('.items').forEach(i => i.classList.remove('active'));
        document.getElementById(type).classList.add('active');
        renderPage(type, currentPage[type]);
    });
});

// 加载 JSON
async function loadJSON(type) {
    try {
        const res = await fetch(`static/data/${type}.json`);
        if(!res.ok) throw new Error('网络错误或文件未找到');
        const json = await res.json();
        dataStore[type] = json;
        renderPage(type, currentPage[type]);
    } catch(e) {
        console.error(`${type} 数据加载失败:`, e);
        document.getElementById(type).innerHTML = `<p>加载失败: ${e.message}</p>`;
    }
}

// 渲染页面
function renderPage(type, page) {
    const container = document.getElementById(type);
    container.innerHTML = '';
    const data = dataStore[type];
    if(!data || data.length === 0) { container.innerHTML = '<p>暂无数据</p>'; return; }
    const start = (page-1)*pageSize;
    const end = Math.min(start+pageSize, data.length);
    for(let i=start;i<end;i++){
        const item = data[i];
        const div = document.createElement('div');
        div.className = 'item';
        const img = document.createElement('img');
        img.src = item.subject?.cover_url || item.subject?.pic?.large || '';
        div.appendChild(img);
        const info = document.createElement('div');
        info.className = 'info';
        const title = document.createElement('h3');
        title.textContent = item.subject.title || '未知标题';
        info.appendChild(title);
        const rating = document.createElement('p');
        if(item.rating?.value) rating.textContent = `评分: ${item.rating.value} (${item.rating.count}人)`;
        else rating.textContent = '暂无评分';
        info.appendChild(rating);
        const date = document.createElement('p');
        date.textContent = '发布时间: '+(item.subject?.pubdate?.[0] || '未知');
        info.appendChild(date);
        const link = document.createElement('a');
        link.href = item.subject?.url || '#';
        link.textContent = '查看详情';
        link.target = '_blank';
        info.appendChild(link);
        div.appendChild(info);
        container.appendChild(div);
    }
    renderPagination(type, page, Math.ceil(data.length/pageSize));
}

// 渲染分页
function renderPagination(type, page, totalPage){
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';
    if(totalPage <= 1) return;
    for(let i=1;i<=totalPage;i++){
        const btn = document.createElement('button');
        btn.textContent = i;
        if(i === page) btn.disabled = true;
        btn.addEventListener('click',()=>{ 
            currentPage[type] = i;
            renderPage(type,i);
        });
        pagination.appendChild(btn);
    }
}

// 页面加载时获取数据
['books','movies','music'].forEach(type => loadJSON(type));
</script>

</body>
</html>
